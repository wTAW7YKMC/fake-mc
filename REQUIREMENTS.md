# 沙盒游戏需求文档

## 1. 项目概述

沙盒游戏是一个类似Minecraft的2D像素风格沙盒游戏，玩家可以在随机生成的世界中自由探索、挖掘方块、收集资源并建造结构。游戏采用HTML5 Canvas和JavaScript技术实现，无需额外插件即可在现代浏览器中运行。

## 2. 核心功能需求

### 2.1 世界生成
- 随机生成具有不同地形特征的游戏世界
- 基于体素系统构建，基础单元为 "1x1x1 立方米体素"
- 包含多种方块类型：草地、泥土、石头、木头、叶子、水、沙子、煤炭、铁矿等
- 生成树木、矿物等自然元素
- 支持无限世界扩展（当前版本为固定大小）
- 区分固体体素（如石头、泥土）和非固体体素（如空气、水）
- 支持透明体素（如玻璃、树叶）和半透明体素（如水、岩浆）的渲染

#### 2.1.1 地形生成算法
- **核心算法**：基于Perlin噪声的多层噪声叠加
  - 第一层噪声：生成高度图，控制地形整体起伏
  - 第二层噪声：生成粗糙度，添加局部细节
  - 第三层噪声：生成生物群系掩码，划分生物群系区域
- **高度范围**：Y轴0-255（0为基岩，255为世界顶部），海平面设为Y=63

#### 2.1.2 生物群系系统
- **基础生物群系**：草原、森林、沙漠、山脉、海洋
- **生物群系属性**：定义方块分布、植被概率、光照强度、温度
- **结构生成**：L系统生成树木，噪声阈值生成洞穴，结构模板生成人造建筑

#### 2.1.3 区块管理系统
- **区块尺寸**：16x256x16体素（X轴16、Y轴256、Z轴16）
- **加载策略**：以玩家为中心的径向加载，默认视距8区块（128米）
- **状态管理**：未生成→生成中→加载→活跃→卸载
- **持久化存储**：二进制文件或SQLite数据库存储区块数据

### 2.2 玩家控制
- 使用WASD键或方向键控制玩家移动
- 支持鼠标左键挖掘方块
- 支持鼠标右键放置方块
- 支持数字键1-9切换物品栏槽位

#### 2.2.1 视角控制系统
- **鼠标控制**：横向移动控制偏航角（0-360°），纵向移动控制俯仰角（-90°至90°）
- **鼠标灵敏度**：默认50，可调节（像素移动量×0.15°/像素）
- **相机位置**：固定在玩家碰撞盒中心点上方0.1米（模拟眼睛高度）

#### 2.2.2 移动物理系统
- **移动速度**：步行4.317m/s，奔跑5.612m/s（左Ctrl加速），潜行2.7m/s
- **跳跃机制**：跳跃初速度3.15m/s，跳跃高度约0.5米
- **空中移动**：阻力为地面的0.8倍，模拟空中滞空感
- **重力系统**：加速度9.8m/s²，终端速度5m/s

#### 2.2.3 交互系统
- **射线检测**：从相机位置发射5米射线，检测体素交点
- **方块破坏**：显示破坏进度条，进度与方块硬度相关，工具加速
- **方块放置**：计算命中面外侧1米处，检测放置条件，显示预览虚影

### 2.3 物品系统
- 实现物品栏系统，支持存储和选择不同类型的方块
- 支持方块的收集、使用和管理
- 物品栏UI显示当前物品数量和选中状态

#### 2.3.1 快捷栏系统
- **快捷栏布局**：底部9个格子，数字键1-9切换，滚轮循环切换
- **物品存储**：存储可放置/使用物品，支持拖拽操作
- **背包系统**：3x9主格子 + 4x4合成格子，按E键打开
- **堆叠机制**：最大堆叠64个物品

#### 2.3.2 手持物品渲染
- **第一人称视角**：工具/方块模型渲染在屏幕右下角
- **手臂模型**：手臂+物品模型组合渲染
- **动态效果**：随视角轻微晃动，模拟手持感

### 2.4 游戏机制
- 挖掘方块需要一定时间，显示进度条
- 挖掘方块后产生粒子效果
- 放置方块时有动画效果
- 玩家移动具有物理效果（加速度、动画）

#### 2.4.1 物理与碰撞系统
- **碰撞盒定义**：
  - 玩家：AABB 0.6x1.8x0.6米，中心点脚部上方0.9米
  - 体素：默认1x1x1米，特殊体素自定义AABB
  - 实体：掉落物0.2x0.2x0.2米，生物0.9x0.9x1.3米
- **碰撞响应**：沿碰撞面法线方向抵消速度，实体间动量守恒
- **特殊物理效果**：
  - 液体浮力：重力减半，移动减速，向上浮力
  - 方块掉落：随机初速度，受重力下落，落地静止

#### 2.4.2 视觉反馈系统
- **方块破坏动画**：目标体素闪烁，透明度随进度变化
- **受伤反馈**：屏幕边缘变红，伴随轻微抖动
- **跳跃/落地反馈**：相机轻微上移/下移，模拟冲击感

### 2.5 音效系统
- 背景音乐播放
- 操作音效（挖掘、放置等）
- 使用Web Audio API实现音频功能

## 3. 用户界面需求

### 3.1 开始界面
- 显示游戏标题"沙盒游戏"
- 提供"开始游戏"按钮
- 美观的背景设计

### 3.2 游戏界面
- 全屏Canvas渲染游戏画面
- 底部物品栏显示可选方块
- 顶部控制说明显示操作指南
- 玩家角色显示在世界中

### 3.3 物品栏界面
- 水平排列的物品槽位
- 显示每个槽位的方块类型和数量
- 当前选中槽位有高亮标识
- 支持点击选择槽位

### 3.4 UI与反馈系统

#### 3.4.1 核心UI元素
- **十字准星**：屏幕中心白色像素十字，大小2x2像素
- **状态HUD**：
  - 生命值：10颗心（每颗心=2点生命），红色，受伤害时闪烁
  - 饥饿值：10根鸡腿，黄色，低于3根时无法奔跑
  - 经验条：底部绿色进度条，随经验值增长
- **交互提示**：方块上方显示名称，不可交互时准星变红

#### 3.4.2 视觉反馈
- **方块破坏动画**：目标体素闪烁，透明度随进度变化，最后碎裂消失
- **受伤反馈**：屏幕边缘变红，伴随轻微抖动
- **跳跃/落地反馈**：跳跃时相机轻微上移，落地时轻微下移

#### 3.4.3 交互反馈
- 挖掘进度条显示在目标方块上方
- 粒子效果增强操作反馈
- 玩家移动动画提升视觉体验

## 4. 技术实现需求

### 4.1 前端技术栈
- HTML5 Canvas用于游戏画面渲染
- CSS3用于界面样式和动画效果
- JavaScript (ES6+)实现游戏逻辑
- Web Audio API实现音效系统

### 4.2 核心模块
- 世界生成模块：负责生成随机游戏世界
- 渲染模块：负责游戏画面的绘制和更新
- 输入处理模块：处理键盘和鼠标输入
- 物理引擎模块：处理玩家移动和碰撞检测
- 音效模块：管理背景音乐和操作音效
- 粒子系统模块：实现挖掘和放置的视觉效果

#### 4.2.1 3D渲染系统
- **渲染管线**：透视投影（FOV 70°±5°），近平面0.1米，远平面256米
- **网格生成**：六面网格生成，背面剔除，相邻面合并优化
- **纹理系统**：纹理图集（256x256/512x512），多级纹理过滤
- **光照系统**：环境光+定向光，光照传播算法（0-15级光照等级）
- **视觉增强**：动态天空盒，雾效，实体渲染（Billboard和骨骼动画）

#### 4.2.2 性能优化模块
- **渲染优化**：视锥体剔除，LOD细节层次，纹理压缩
- **逻辑优化**：区块异步生成，实体休眠机制

### 4.3 性能要求
- 保持稳定的帧率（目标60FPS）
- 优化渲染性能，避免卡顿
- 内存使用合理，避免内存泄漏
- 支持主流现代浏览器

### 4.4 兼容性要求
- 支持Chrome、Firefox、Safari、Edge等现代浏览器
- 响应式设计，适配不同屏幕尺寸
- 支持Windows、macOS、Linux操作系统

## 5. 部署需求

### 5.1 本地运行
- 支持通过本地服务器运行（如Python http.server）
- 提供批处理文件简化本地启动流程
- 支持VS Code Live Server等开发工具

### 5.2 在线部署
- 支持GitHub Pages部署
- 提供详细的部署指南文档
- 包含自动化部署脚本

## 6. 扩展功能需求（未来规划）

### 6.1 游戏机制扩展
- 实现合成系统，支持制作工具和物品
- 添加生物系统，如动物和怪物
- 实现日夜循环和天气系统
- 添加生命值和饥饿值系统

### 6.2 多人游戏
- 支持多人在线协作
- 实现服务器端逻辑
- 添加聊天系统

### 6.3 内容扩展
- 添加更多方块和物品类型
- 实现更复杂的地形生成算法
- 添加任务和成就系统